sudo: false
language: node_js
services: 
  - mongodb
  - redis-server
  - mysql
env:
  - MONGOLAB_URL=mongodb://127.0.0.1/snipe LOG_MONGOLAB_URL=mongodb://127.0.0.1/snipelogs REDIS_URL=redis://127.0.0.1/1 SECURE_MODE=true NO_CACHE=no SQL_HOST=127.0.0.1
addons:
  apt:
    sources:
    - mongodb-3.0-precise
    packages:
    - mongodb-org-server
node_js:
  - '22'
before_script:
  - sleep 15
  - npm install -g gulp mocha gulp-cli nyc tsx typescript
before_install:
  - mysql -e 'CREATE DATABASE snipe;'
install:
  - npm install
  - npm run build
  - gulp service -n api
  - gulp service -n test -b http://localhost:8080 -e apis
  - gulp service --sql -n apisql
  - npm start >> femi.log . &
script:
  - sleep 15
  - npm run test:coverage
  - npm run type-check
after_success:
  - nyc report --reporter=text-lcov | codecov
